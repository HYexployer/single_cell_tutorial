# 1-2. 单细胞RNA测序

本章简要介绍了最常用的单细胞核糖核酸（RNA）测序技术以及相关的基本分子生物学概念。多模态或空间测序不在此章节涉及范围内，而是在相应的高级章节中介绍。所有测序技术都具有各自的优势和局限性，数据分析人员必须了解这些，以便意识到数据可能存在的偏差。

## 1. 生命的构成单元

众所周知，生命是区分生物体与死亡或无生命实体的特征。对术语“生命”的大多数定义都有一个共同的实体——细胞。细胞形成开放系统，维持稳态，具有新陈代谢，生长，适应环境，繁殖，对刺激做出反应，并自我组织。因此，细胞是构成生命的基本单元，最早由英国科学家罗伯特·胡克在1665年发现。胡克使用非常原始的显微镜观察了一片薄薄的软木片，惊讶地发现这片软木看起来像蜂巢。他将这些微小的单位称为“细胞”。

<figure markdown>
  ![Image title](https://www.sc-best-practices.org/_images/hooke_cork.jpg){ width="500" }
  <figcaption>细胞图</figcaption>
</figure>
1839年，马蒂亚斯·雅各布·施莱登（Matthias Jakob Schleiden）和提奥多尔·施旺（Theodor Schwann）首次描述了细胞理论。细胞理论描述了所有生物体都由细胞组成。细胞作为功能单元，自身从其他细胞中产生，使它们成为繁殖的基本单位。

自细胞理论的早期定义以来，研究人员发现细胞内存在着能量流动，遗传信息以DNA的形式从一细胞传递到另一细胞，而且所有细胞几乎具有相同的化学组成。存在两种一般类型的细胞，真核细胞和原核细胞。真核细胞包含有核，核膜包裹着染色体；而原核细胞只有一个核区域，没有核。细胞核承载着细胞的基因组脱氧核糖核酸（DNA），也是真核细胞名称的由来：核（Nucleus）在拉丁语中表示核心或种子。真核生物是由单个细胞（单细胞）或多个细胞（多细胞）组成的生物体，而原核生物是单细胞生物。真核细胞与原核细胞的区别在于它们高度分室化，即包含有膜的细胞器执行高度专门化的功能，并为细胞提供关键支持。

与原核细胞相比，真核细胞平均体积大约是它的10,000倍，并具有丰富的细胞器混合物和由微管、微丝和中间丝组成的细胞骨架。DNA复制机制读取核中存储的DNA中的遗传信息，以复制自身并维持生命周期。真核DNA被分成几个线性束，称为染色体，在细胞核分裂期间由微管纺锤体分离。理解隐藏在DNA中的遗传信息对于理解许多进化和与疾病相关的过程至关重要。测序是解码DNA核苷酸顺序的过程，主要用于揭示特定DNA片段、完整基因组甚至复杂的微生物组携带的遗传信息。DNA测序使研究人员能够确定DNA分子和基因组中的基因和调控元件的位置和功能，并揭示开放阅读框（ORFs）或CpG岛等遗传特征，这些特征指示启动子区域。进化分析是另一个非常常见的应用领域，其中比较不同生物体的同源DNA序列。DNA测序还可以用于研究突变与疾病之间的关联，有时甚至用于疾病抵抗性等，被认为是最有用的应用之一。

一个非常常见的例子是镰刀红细胞病，一组血液疾病，由红细胞中氧载体蛋白质血红蛋白的异常引起。这导致严重的健康问题，包括疼痛、贫血、手脚肿胀、细菌感染和中风。镰刀红细胞病的原因是从每个父母那里继承两个异常的β-球蛋白基因（HBB），这些基因编码血红蛋白。基因缺陷是由单核苷酸突变引起的，其中GAG密码子变为GTG密码子的β-球蛋白基因。这导致氨基酸谷氨酸在位置6被缬氨酸取代（E6V置换），从而导致了上述疾病。不幸的是，并不总是可能找到单核苷酸突变与疾病之间的这种“简单”关联，因为大多数疾病由复杂的调控过程引起。

## 2. 测序的简要历史

### 2.1 第一代测序

尽管DNA已经在1869年由弗里德里希·米切尔首次分离出来，但科学界花了100多年才发展出高通量测序技术。
1953年，沃森、克里克和富兰克林发现了DNA的结构；1965年，罗伯特·霍利首次测序了一种tRNA。
七年后的1972年，瓦尔特·菲尔斯首次测序了一段完整的基因（噬菌体MS2的外壳蛋白），他使用RNAses消化病毒RNA，分离寡核苷酸，最后通过电泳和色谱法将它们分离开来。
与此同时，弗里德里希·桑格发展了一种使用放射性标记的部分消化片段的DNA测序方法，被称为“链终止法”，更常被称为“桑格测序”。尽管桑格测序仍然被广泛使用至今，但它存在一些缺点，包括缺乏自动化和耗时。
1987年，勒罗伊·胡德和迈克尔·哈卡皮勒开发了ABI 370仪器，这是一种自动化桑格测序过程的仪器。它最重要的创新成就是将DNA片段的标记自动化为荧光染料，而不是放射性分子。这种改变不仅使方法的执行更安全，而且允许计算机分析获得的数据。

优势：

- 桑格测序简单且经济实惠。
- 如果操作正确，错误率非常低（<0.001%）。

限制：

- 桑格测序只能测序约300到1000个碱基对（bp）的短DNA片段。
- 桑格测序结果的质量在前15到40个碱基处通常不太好，因为这是引物结合的位置。
- 测序在700到900个碱基后退化。
- 如果测序的DNA片段已经被克隆，一些克隆载体序列可能出现在最终的测序结果中。
- 桑格测序的成本比第二代或第三代测序每测序碱基更高。

### 2.2 第二代测序

九年后的1996年，莫斯塔法·罗纳吉、马蒂亚斯·乌伦和帕尔·尼雷尼引入了一种新的DNA测序技术，称为焰火测序，开启了第二代测序的时代。
第二代测序，也称为下一代测序（NGS），主要得益于实验室中进一步的自动化、计算机的应用和反应的微型化。
焰火测序通过测序过程中合成焦磷酸盐生成的发光来测量光亮度。
这个过程也常被称为“合成测序”。
两年后，Shankar Balasubramanian和David Klenerman在Solexa公司开发并适应了合成测序过程，该方法利用荧光染料。Solexa的技术也成为了Illumina测序仪的基础，该测序仪在市场上占据主导地位。
2005年开发的Roche 454测序仪是第一台能够完全自动化焰火测序过程的测序仪，它是一台单一的自动化机器。
随后推出了许多其他平台，例如SOLiD系统的“连接测序”（2007年）和Life Technologies的Ion Torrent（2011年），Ion Torrent使用“合成测序”来检测新合成的DNA时的氢离子。

优势：

- 第二代测序通常是所需化学物质成本最低的选择。
- 可以使用稀疏材料作为输入。
- 高灵敏度，可以检测低频变异并进行全面的基因组覆盖。
- 高容量，可进行样本多重复性测序。
- 能够同时测序成千上万个基因。

限制：

- 测序仪价格昂贵，通常需要与同事共享使用。
- 第二代测序仪体积庞大，固定不动，不适用于野外工作。
- 通常，第二代测序结果包含许多短的

测序片段（reads），这些片段难以用于新的基因组。
- 测序结果的质量取决于参考基因组。

### 2.3 第三代测序

第三代测序，现在也被称为下一代测序，为市场带来了两项创新。
首先，长读测序，即获得比通常的Illumina短读测序仪生成的长度更长的核苷酸片段（大约75到300个碱基对，具体取决于测序仪）。这对于组装没有可用参考基因组的新基因组尤为重要。其次，实时测序的能力是第三代测序的又一重大进步。结合便携式测序仪的使用，这些仪器体积小巧，不需要进一步的复杂设备进行化学反应，测序现在已经“适合现场使用”，即使远离实验室设施也可以采集样品。

Pacific Biosciences（PacBio）在2010年推出了零模波导（ZMW）测序技术，它使用所谓的包含单个DNA聚合酶的纳米孔。这允许直接观察任何单个核苷酸的结合过程，并通过纳孔孔下方的探测器进行测定。每种类型的核苷酸都用特定的荧光染料标记，这些荧光染料在结合过程中发出荧光信号，随后被测量为序列读出。从PacBio测序仪获得的读数通常为8到15千碱基（kb），可达70kb。

Oxford Nanopore Technologies在2012年推出了GridION。GridION及其后续产品MinION和Flongle是便携式的DNA和RNA测序仪，可产生超过2Mb的读数。值得注意的是，这样的测序设备甚至适合一个人的手掌。Oxford Nanopore测序仪通过观察核酸通过蛋白质纳米孔时发生的电流变化来识别核苷酸序列。

优势：

- 长读测序将实现大型新基因组的组装。
- 测序仪便携，适用于野外工作。
- 直接检测DNA和RNA序列的表观遗传修饰。
- 速度快，第三代测序仪快速。

限制：

- 一些第三代测序仪的错误率比第二代测序仪高。
- 试剂通常比第二代测序更昂贵。

## 3. NGS流程概述

虽然存在多种NGS技术，但DNA测序（因此也包括反转录的RNA）的一般步骤大致相同。主要的差异在于各种测序技术的化学特性。

1. **样品和文库准备**：首先，通过将DNA样品断裂并与适配器分子连接来准备所谓的文库。适配器分子在文库片段与基质的杂交和引物结合中起作用。

2. **扩增和测序**：在第二步中，文库转化为单链分子。通过扩增步骤（例如聚合酶链反应），创建DNA分子的簇。在单次测序运行期间，所有簇都执行个体反应。

3. **数据输出和分析**：测序实验的输出取决于测序技术和化学方法。一些测序仪产生荧光信号，将其存储在特定的输出文件中，而其他测序仪可能产生电信号，将其存储在相应的文件格式中。通常，生成的数据量（原始数据）非常大。这些数据需要进行复杂且计算密集的处理。这在原始数据处理部分进一步讨论。



## 4. RNA测序

到目前为止，我们只介绍了未提及的DNA测序，但是，仅了解一个生物体的DNA序列和其调控元素的位置对于细胞的动态和实时运行提供的信息非常有限。
例如，通过将同一mRNA前体的不同mRNA剪接位点和外显子结合在一起，一个基因可以编码多个蛋白质。这种选择性剪接事件在真核生物中是自然发生的，也很常见；然而，一个变异可能潜在地导致非功能性酶和诱发疾病状态。这就是RNA测序（RNA-Seq）的用武之地。
RNA-Seq在很大程度上遵循DNA测序的协议，但包括一个逆转录步骤，其中从RNA模板合成互补DNA（cDNA）。测序RNA使科学家能够以基因表达的形式在测序时获得细胞、组织或生物体的快照。
这些信息可以用于检测疾病状态对治疗的反应，在不同的环境条件下，比较基因型以及其他实验设计中的变化。
现代RNA测序允许对转录本进行无偏采样，与例如基于微阵列的分析或{term}`RT-qPCR`相比，后者需要设计探针专门靶向感兴趣的区域。
获得的基因表达谱还可以检测基因异构体、基因融合、单核苷酸变异和许多其他有趣的特性。
现代RNA测序不受先前知识的限制，并允许捕获已知和新颖特征，产生丰富的数据集，可用于探索性数据分析。

## 5. 单细胞RNA测序

### 5.1 概述

RNA的测序主要可以通过两种方式进行：一种是对源自感兴趣细胞的混合RNA进行测序（批量测序），另一种是对细胞的转录组进行单独测序（单细胞测序）。将所有细胞的RNA混合在一起通常比实验复杂的单细胞测序更便宜且更容易。批量RNA-Seq得到的是细胞平均的表达谱，通常更容易分析，但也隐藏了一些复杂性，如细胞表达谱的异质性，这可能有助于回答感兴趣的问题。

一些药物或干扰可能仅影响特定的细胞类型或细胞类型之间的相互作用。例如，在肿瘤学中，可能存在导致复发的罕见耐药肿瘤细胞，即使在培养细胞中也很难通过简单的批量RNA-Seq鉴定。

为了揭示这种关系，有必要对单细胞水平上的基因表达进行研究。单细胞RNA-Seq（scRNA-Seq）然而具有一些注意事项。首先，单细胞实验通常更昂贵且更难以正确进行。其次，由于分辨率的增加，下游分析变得更加复杂，更容易得出错误的结论。

一般来说，单细胞实验遵循与批量RNA-Seq实验相同的步骤（见上文），但需要进行一些适应。与批量测序类似，单细胞测序需要裂解、逆转录、扩增和最终测序。
此外，单细胞测序还需要细胞分离和物理分隔为更小的反应腔室或其他形式的细胞标记，以便在后续阶段将获得的转录组映射回原始细胞。
因此，这些也是大多数单细胞测序方法的步骤之处：单细胞分离、转录本扩增和根据测序机器的不同，测序。在解释不同测序方法的工作原理之前，我们将在下面更详细地讨论转录本定量。


### 5.2 转录本定量

转录本定量是将测序的转录本与基因序列进行计数的过程。这些计数最终进入计数表中。关于这个计算过程的更多细节将在下一章中描述。转录本定量有两种主要方法：全长和标签方法。

全长协议尝试用测序读数均匀覆盖整个转录本，而标签基协议只捕获转录本的5'端或3'端。转录本定量方法对捕获的基因有很强的影响，因此分析人员必须了解所使用的定量过程。全长测序仅适用于基于板的协议（见下文），而库制备与批量RNA测序相似。并非总是能够实现转录本的均匀覆盖，因此仍可能对基因体的特定区域存在偏差。全长协议的主要优点是它们可以检测到剪接变体。

标签协议仅测序转录本的3'端或5'端。这样做的代价是不一定（不一定）覆盖整个基因长度，从而使读数能够明确地与一个转录本对齐并区分不同的亚型{cite}`Archer2016`。然而，它允许使用唯一的分子标识符（UMI），这对于解决转录本扩增过程中的偏差非常有用。

转录本扩增是任何RNA测序运行的关键步骤，以确保转录本足够丰富以进行质量控制和测序。在这个过程中，通常使用聚合酶链反应（PCR）从原始分子的相同片段制备拷贝。由于拷贝和原始分子是无法区分的，确定样品中原始分子的数量变得具有挑战性。使用UMI是量化原始的、非重复的分子的常见解决方案。

UMI作为分子条形码，有时也被称为随机条形码。这些“条形码”由添加到样品中的每个分子上的短的随机核苷酸序列组成，作为唯一的标签。UMI必须在扩增步骤之前的文库生成过程中添加。准确识别PCR重复的能力对于下游分析来说是重要的，以排除或了解扩增偏差{cite}`Aird2011`。

扩增偏差是指被有选择性扩增的RNA/cDNA序列，因此它们将被测序更多次，导致更高的计数。这对于任何基因表达分析都可能产生不利影响，因为不活跃的基因可能突然表现出高表达。对于在PCR步骤的后期被扩增的序列尤其如此，此时错误率可能已经比早期PCR阶段更高。

虽然在计算上可以通过删除具有相同对齐坐标的读取来检测和删除此类序列，但通常建议始终在可能的情况下设计带有UMI的实验。使用UMI还可以在不损失准确性的情况下执行基因计数的归一化处理{cite}`Kivioja2012`。



### 5.3 单细胞测序协议

目前，存在三种类型的单细胞测序协议，这些协议主要根据其细胞分离协议进行分组：基于微流控装置的策略，其中细胞被封装在水凝胶液滴中；基于孔板的协议，其中细胞被物理分离到小孔中；以及商业化的Fluidigm C1微流控芯片解决方案，可以将细胞加载和分离到小的反应腔室中。这三种方法在恢复转录本、测序的细胞数以及许多其他方面都有所不同。
在接下来的小节中，我们将简要讨论它们的工作原理、优点和缺点，以及数据分析人员应该注意的相关协议偏倚。

#### 5.3.1 基于微流控装置的协议

基于微流控装置的单细胞策略将细胞困在水凝胶液滴中，使其分隔为单个细胞反应腔。目前最常用的协议包括inDrop{cite}`Klein2015`、Drop-seq{cite}`exp:Macosko2015`和商业化的10x Genomics Chromium{cite}`exp:Zheng2017`，可以每秒产生数千个这样的液滴。这种高度并行的过程以相对较低的成本产生非常高数量的液滴。尽管这三种协议在细节上有所不同，但总是设计能够同时捕获珠子和细胞的纳升级液滴。

封装过程是使用专门的微珠进行的，这些微珠带有包含PCR手柄、细胞条码和4-8个碱基对长的唯一分子识别码（UMI-见下文）和聚合物T尾的引物。细胞溶解后，mRNA立即释放并被附着在微珠上的条形码寡核苷酸捕获。接下来，收集和破裂液滴，以释放与微粒附着的单细胞转录组（STAMPs）。然后进行PCR和逆转录以捕获和扩增转录本。

最后进行标签化，其中转录本被随机切割并连接测序适配体。这个过程产生了准备好进行测序的测序文库，如上所述。在基于微流控装置的协议中，只有大约10%的细胞转录本得到恢复{cite}`Islam2014`。值得注意的是，这种低测序足以稳健地识别细胞类型。

这三种基于微流控装置的方法都会产生特定的偏差。所使用的珠子的材料在协议之间有所不同。Drop-seq使用易碎树脂制造的珠子，因此珠子以泊松分布封装，而InDrop和10X Genomics珠子是可变形的，导致珠子占有率超过80%{cite}`Zhang2019`。

此外，捕获效率可能受到Drop-Seq中使用的表面固定引物的影响。InDrop使用的是光解除的引物，而10X genomics则溶解了珠子。这种差异还会影响逆转录过程的位置。Drop-seq中的逆转录发生在珠子从液滴中释放后，而InDrop和10X genomics协议中逆转录发生在液滴内部{cite}`Zhang2019`。

2019年Zhang等人的比较发现，在珠子的质量方面，InDrop和Drop-seq被10X Genomics超越。前两个系统中的细胞条码包含明显的不匹配。此外，来自有效条码的读取比例为10X Genomics为75%，而InDrop为25%，Drop-seq为30%{cite}`Zhang2019`。

对于敏感性，10X Genomics也表现出了类似的优势。在他们的比较中，10X Genomics平均每个细胞捕获了约3000个基因的17000个转录本，而Drop-seq捕获了约2500个基因的8000个转录本，InDrop捕获了约1250个基因的2700个转录本{cite}`Zhang2019`。

实际产生的数据显示了明显的协议偏差。10X Genomics倾向于捕获和扩增较短基因和具有较高GC含量的基因，而与之相比，Drop-seq更偏好具有较低GC含量的基因。

尽管10X Genomics在各个方面的表现都优于其他协议，但其每个细胞的成本也是其他协议的两倍左右。此外，除了珠子外，Drop-seq是开源的，如果需要，该协议更容易进行适应。InDrop完全开源，即使在实验室也可以制造和修改珠子。因此，InDrop是这三种协议中最灵活的。

优点：

- 可以成本效益地测序大量细胞，以识别组织的整体组成并表征罕见的细胞类型。
- 可以整合UMI。

局限性：

- 与其他方法相比，转录本检测率较低。
- 只捕获3'端而不是整个转录本，因为细胞条码和PCR手柄仅添加到转录本的末端。

#### 5.3.2 基于孔板的协议

基于孔板的协议通常将细胞物理分离到微孔板中的单个孔中。第一步是通过荧光激活的细胞分选（FACS）（例如，根据特定的细胞表面标记物）或微量移液将细胞分选。然后，选择的细胞被置于包含细胞裂解缓冲液的单个孔中，随后进行逆转录。这使得可以在单个实验中分析数百个细胞，每个细胞捕获5000到10000个基因。

基于孔板的测序协议包括SMART-seq2、MARS-seq、QUARTZ-seq和SRCB-seq等等。一般来说，这些协议在其多重复能力方面有所不同。例如，MARS-seq允许三个条码级别，即分子、细胞和孔板级别的标签，以实现稳健的多重复能力。相反，SMART-seq2不允许早期多重复，从而限制了细胞数量。Mereu等人在2020年的一项系统性比较研究中发现，QUARTZ-seq2每个细胞能够捕获的基因数量超过SMART-seq2、MARS-seq和10X Genomics Chromium等协议。

优点：

- 转录本检测率较高，可以捕获细胞中更多的转录本。
- 可以在细胞和孔板级别添加多个条码，以增加复制能力。

局限性：

- 测序的细胞数量相对较少。
- 较高的成本。

#### 5.3.3 Fluidigm C1

Fluidigm C1是一个商业化的解决方案，用于单细胞测序。它使用集成的微流控芯片将单个细胞加载到不同的反应腔中，并将逆转录和扩增步骤与仪器捆绑在一起。
与基于微流控装置的协议相比，Fluidigm C1的优点是对每个细胞的转录组覆盖度更高，并且可以获得更高的转录本检测率。然而，它的成本较高，并且需要专门的仪器和芯片。

优点：

- 转录本检测率较高。
- 较高的转录组覆盖度。

局限性：

- 成本较高。
- 需要专门的仪器和芯片。

以上是目前常用的单细胞测序协议的简要概述。每种协议都有其特定的优点和局限性，选择适当的协议取决于研究目的、预算和实验室资源。

### 5.4 数据分析

单细胞RNA测序数据的分析是一个复杂的过程，涉及多个步骤和算法。以下是一般性的数据分析流程：

1. **质量控制**：首先，对测序数据进行质量控制，包括检查测序读数的质量分数、去除低质量的读数和检测可能的测序偏差。

2. **数据预处理**：对原始数据进行预处理，包括去除低质量的细胞、去除环境RNA的污染、校正测序偏差、归一化转录本计数等。

3. **细胞聚类**：使用聚类算法将单个细胞分成不同的群集，每个群集代表一个细胞类型或亚型。

4. **细胞亚型分析**：在每个细胞类型或群集中，进一步分析细胞的亚型和状态，包括特征基因的识别、差异表达分析、细胞亚型标记物的鉴定等。

5. **细胞状态转换分析**：对细胞进行时间轴分析，以了解细胞状态的转换和发育过程。

6. **细胞间相互作用分析**：分析细胞之间的相互作用、细胞群集之间的关系以及细胞状态的转移。

7. **功能注释和通路分析**：对不同细胞类型或亚型中的基因进行功能注释和通路分析，以了解其在生物学过程中的功能和相互关系。

这只是单细胞RNA测序数据分析的一般流程。实际分析可能会根据具体的研究问题和数据的特点而有所不同。对于每个步骤，有多种算法和工具可供选择，研究人员应根据其需求和数据特点选择适当的方法。

希望这些信息能够帮助您了解NGS和单细胞测序的一般原理和流程。请注意，这只是一个概述，NGS和单细胞测序是广泛且不断发展的领域，仍有许多新的技术和方法被引入和改进。对于更详细和具体的信息，建议参考相关文献和专业资源。